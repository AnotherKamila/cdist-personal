#!/bin/sh

case $__target_host in
	*ungleich*)
		echo 'Nope.' >&2
		exit 47
	;;
esac


__cdistmarker
__hostname
__locale "en_US.UTF-8"
__locale "de_CH.UTF-8"
if [ -z "$CDIST_NO_PACKAGE_INDEX_UPDATE" ]; then
	case $(cat $__explorer/os) in
		debian|ubuntu|devuan)
			__apt_update_index
			export require="$require __apt_update_index"
		;;
	esac
fi

case $__target_host in
	entropy)
		. $__manifest/cozy
		. $__manifest/all_the_things

		__kamila_dotfiles --graphical

		# for now
		__ethz_asl_host skamila --user kamila

	;;

	ev3)
		__user robot
		require="$require __user/robot" __ssh_authorized_keys robot --key "$(cat $__manifest/files/kamila.pub)"

		. $__manifest/python
		__file /home/robot/rpyc_server.sh --mode 0755 --source - <<-EOF
			#!/bin/sh
			python3 \$(which rpyc_classic.py)
		EOF

		__file /etc/systemd/system/ev3dev-leds.service --source $__manifest/files/ev3dev-leds.service
	;;

	asl*)
		. $__manifest/cozy
		__ethz_asl_host skamila --user kamila
	;;

esac
